var Answers={currentCity:{},countries:[],bonus:[],cities:[],reset:function(){this.currentCity={};this.countries=[];this.cities=[];this.bonus=[]}};var City=function(){this.name="";this.dbPediaUrl="";this.photoCollection="";this.country="";this.hint="";this.sights=[];this.reset=function(){this.name="";this.dbPediaUrl="";this.country="";this.hint="";this.dbPediaUrl="";this.sights=[];this.photoCollection=""}};var Sight=function(){this.name="";this.dbPediaUrl="";this.photoCollection="";this.pictures=[]};var Game={startQuesPts:1000,penaltyDistance:1000,quesPerRound:10,distanceBonusQuestion:200,hintPoints:-400,morePicsPoints:-200,bonusPoints:100,pointsTotal:0,questionNr:0,hasMorePics:false,hasHint:false,setQuestionNr:function(){if(this.questionNr<this.quesPerRound){this.questionNr=this.questionNr+1}else{var a=$("#endOfRound");a.find("b").html(this.pointsTotal+" Points");this.displayDialog(a)}},newRound:function(){this.pointsTotal=0;this.questionNr=0;this.hasMorePics=false;this.hasHint=false;Answers.reset();Question.getCities()},calculatePoints:function(a,c){var b=0;if(a!==null){a=Math.round(a);if(a<this.penaltyDistance){b=this.startQuesPts-a}this.pointsTotal+=b}if(c!==null){this.pointsTotal+=c}this.setPoints();return b},setPoints:function(){var a=$("#points");a.text(this.pointsTotal)},displayDialog:function(a){var b=window.innerWidth,e=window.innerHeight,d=0,c=0;$("#map_canvas").block({message:null,overlayCSS:{opacity:0.4}});d=(b-a.outerWidth())/2;c=(e-a.outerHeight())/2;a.css({left:d+"px",top:c+"px"}).fadeIn()}};var Question={getCities:function(){$.getJSON("getCity.php",function(c){var b,d,a;for(b=0,a=c.length;b<a;b+=1){d=new City();d.name=c[b][0];d.dbPediaUrl=c[b][1];d.country=c[b][2];Answers.countries.push(c[b][2]);Answers.cities.push(d)}console.log(Answers.cities);Question.generate()})},generate:function(){Game.setQuestionNr();Answers.bonus=[];$("#answer").fadeOut();$("#bonusQuestion").fadeOut();var a=$("#getInfo");a.find("b:last").hide();a.find("b:first").show();a.unblock();Answers.currentCity=Answers.cities.pop();console.log(Answers.currentCity);if(Game.questionNr===1){this.getPictures(false)}else{Map.load();Game.hasMorePics=false;Game.hasHint=false;$("#getMorePics").unblock();this.displayQuestion()}this.getPictures(true);this.getHint();this.getBonusQuestion()},getHint:function(){var a=Answers.currentCity.name.replace(/ /g,"_");$.getJSON("getInfo.php",{city:a,dbPediaUrl:Answers.currentCity.dbPediaUrl},function(b){if(!b){$("#getInfo").block({message:null})}Answers.currentCity.hint=b;console.log(Answers.currentCity.hint)})},getPictures:function(b){var a=Answers.cities[Answers.cities.length-1],c="";if(!b||Answers.cities.length===0){a=Answers.currentCity}c=a.name.replace(/ /g,"_");console.log("bilder fuer "+c);$.getJSON("getPictures2.php",{location:c},function(d){var e=d.City;a.photoCollection=e.PhotoCollection;$.each(e.Locations,function(f,g){var h=new Sight();h.name=g.Name;h.dbPediaUrl=g.URL;h.photoCollection=g.PhotoCollection;$.each(g.PictureURLs[0],function(i,j){h.pictures.push(j)});$.each(g.PictureURLs[1],function(i,j){h.pictures.push(j)});a.sights.push(h)});if(!b){Question.displayQuestion()}})},getBonusQuestion:function(){var d,b=[],a=0,c=Answers.countries.length-1;for(d=0;b.length<3;d+=1){a=Math.floor(Math.random()*c);if($.inArray(Answers.countries[a],b)===-1&&Answers.countries[a]!=="United Kingdom"){b.push(Answers.countries[a])}}a=Math.floor(Math.random()*2.9);if($.inArray(Answers.currentCity.country,b)===-1){b[a]=Answers.currentCity.country}$.getJSON("getFlag.php",{countries:b},function(e){$.each(e,function(h,f){var g={name:h,flag:f};Answers.bonus.push(g)});console.log(Answers.bonus)})},evalBonusQuestion:function(a){if(a===Answers.currentCity.country){Game.calculatePoints(null,Game.bonusPoints);$("#bonusQuestion").find("form").fadeOut("fast",function(){$("#bonusCorrect").fadeIn("fast")})}else{$("#bonusQuestion").find("form").fadeOut("fast",function(){$("#bonusWrong").fadeIn("fast")})}},displayBonusQuestion:function(){$("#bonusQuestion").find("b").hide();
$("#bonusQuestion").find("form").show();$("#bonusQuestion").find("label").each(function(a){$(this).find("input").attr("value",Answers.bonus[a].name);$(this).find("img").attr("src",Answers.bonus[a].flag);$(this).find("input").click(function(b){b.preventDefault();var c=$(this).val();Question.evalBonusQuestion(c)})});$("#bonusQuestion").show()},displayHint:function(){$("#hintText").html(Answers.currentCity.hint);if($("#hint").is(":visible")){this.picturesSlide("up")}if($("#hint").is(":hidden")){this.picturesSlide("down")}},picturesSlide:function(d){var b=$("#getInfo"),c=$(".polaroid"),a=0;if(d==="up"){c.each(function(f){var e=f*-20;$(this).animate({top:e+"px"},400)});$("#hint").slideUp();b.find("span:last").hide();b.find("span:first").show()}if(d==="down"){a=$("#hint").outerHeight(true);c.each(function(f){if(f>0){var e=f*a/2;$(this).animate({top:"-="+e},400)}});$("#hint").slideDown();b.find("span:first").hide();b.find("span:last").show();b.find("b:first").hide();b.find("b:last").show()}},displayQuestion:function(a){a=typeof(a)!=="undefined"?a:0;if($("#hint").is(":visible")){this.picturesSlide("up")}$(".polaroid").find("img").each(function(b){$(this).attr("src",Answers.currentCity.sights[b].pictures[a])});$(".polaroid").fadeOut("slow",function(){$(this).fadeIn("slow")});$("#progress").html("Question "+Game.questionNr+" out of 10:")},displayAnswer:function(a){var c=$("#answer"),b="<b>"+a[2]+" points!</b>The correct answer is:<b>"+Answers.currentCity.name+"</b>You missed it by "+a[0]+"km. <br>That would mean a "+a[1]+" drive.";c.find("#answerText").html(b);if(a[0]<=Game.distanceBonusQuestion){this.displayBonusQuestion()}Game.displayDialog(c);this.writeResult()},writeResult:function(){$.post("writeResult.php",{city:Answers.currentCity})}};var Map={markersArray:[],infowindowsArray:[],map:{},directionsService:{},directionsDisplay:{},config:{myLatlng:new google.maps.LatLng(48.99643826296838,8.397674685546917),rendererOptions:{preserveViewport:true},mapStyle:[{featureType:"all",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"administrative.country",elementType:"geometry",stylers:[{visibility:"on"}]},{featureType:"road",elementType:"geometry",stylers:[{visibility:"off"}]}],myOptions:{zoom:5,center:new google.maps.LatLng(48.99643826296838,8.397674685546917),draggableCursor:"crosshair",mapTypeControl:false,navigationControlOptions:{style:google.maps.NavigationControlStyle.SMALL,position:google.maps.ControlPosition.TOP_RIGHT},streetViewControl:false,mapTypeId:google.maps.MapTypeId.TERRAIN}},load:function(){this.map=new google.maps.Map(document.getElementById("map_canvas"),this.config.myOptions);var a={map:this.map,name:"Spiel"},b=new google.maps.StyledMapType(this.config.mapStyle,a);this.directionsService=new google.maps.DirectionsService();this.directionsDisplay=new google.maps.DirectionsRenderer(Map.config.rendererOptions);this.map.mapTypes.set("Spiel",b);this.map.setMapTypeId("Spiel");google.maps.event.addListener(this.map,"click",function(c){Map.getDistance(c.latLng)})},getDistance:function(a){var c=[],b=a,d={origin:Answers.currentCity.name+", "+Answers.currentCity.country,destination:b,provideRouteAlternatives:false,travelMode:google.maps.DirectionsTravelMode.DRIVING,unitSystem:google.maps.DirectionsUnitSystem.METRIC};this.directionsDisplay.setMap(this.map);this.directionsService.route(d,function(e,f){if(f===google.maps.DirectionsStatus.OK){Map.directionsDisplay.setDirections(e);c[0]=Math.round(e.routes[0].legs[0].distance.value/1000);c[1]=e.routes[0].legs[0].duration.text;c[2]=Game.calculatePoints(c[0],null);Question.displayAnswer(c)}})}};var Eurotrip={init:function(){Question.getCities();Map.load();$.blockUI.defaults.css={};Game.displayDialog($("#welcome"));var a=$("#getInfo");a.find("span:last").hide();a.find("b:last").hide();$("#getMorePics").click(function(b){b.preventDefault();if(Game.hasMorePics===false){Answers.currentCity.images=[];
Question.displayQuestion(1);$(this).block({message:null});Game.hasMorePics=true;Game.calculatePoints(null,Game.morePicsPoints)}});$("#getInfo").click(function(b){b.preventDefault();Question.displayHint();if(Game.hasHint===false){Game.calculatePoints(null,Game.hintPoints);Game.hasHint=true}});$("#answer").find("a").click(function(b){b.preventDefault();Question.generate()});$("#startGame").click(function(b){b.preventDefault();$("div#map_canvas").unblock();$("#welcome").fadeOut()});$("#newRound").click(function(b){b.preventDefault();Game.newRound();$("#endOfRound").fadeOut()})}};$(function(){Eurotrip.init()});